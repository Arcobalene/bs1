# Функциональность загрузки фото работ мастера

## Описание

Реализована возможность для мастеров загружать фото своих работ в личном кабинете. Эти фото автоматически отображаются на страницах всех салонов, где мастер работает.

## Реализованные компоненты

### 1. Backend API

#### Новые эндпоинты:

1. **POST `/api/master/photos`** - Загрузка фото работ
   - Требует авторизации мастера (`requireMaster`)
   - Принимает до 10 файлов за раз
   - Сохраняет фото в MinIO и метаданные в БД
   - Автоматически создает запись мастера, если её нет

2. **GET `/api/master/photos`** - Получение списка фото мастера
   - Требует авторизации мастера
   - Возвращает все фото работ мастера с URL

3. **DELETE `/api/master/photos/:filename`** - Удаление фото
   - Требует авторизации мастера
   - Удаляет фото из MinIO и БД

#### Обновленные эндпоинты:

- **GET `/api/masters/:userId`** - Теперь также включает мастеров из `salon_masters` и их фото
  - Объединяет мастеров, добавленных напрямую в салон
  - И мастеров, добавленных через `salon_masters`
  - Автоматически показывает фото работ для всех мастеров

### 2. База данных

#### Новая функция:

- **`masters.getOrCreateMasterRecord(masterUserId, masterUsername)`**
  - Получает первую запись мастера для пользователя-мастера
  - Или создает новую запись, если её нет
  - Используется при загрузке фото

### 3. Frontend

#### Обновленная страница мастера (`views/master.html`):

- Добавлена секция "Фото моих работ" на вкладке "Профиль"
- Интерфейс загрузки фото (drag & drop через input file)
- Галерея загруженных фото с возможностью удаления
- Визуальная обратная связь (loading states, alerts)

#### Страница салона (`views/booking.html`):

- Уже существующая функциональность отображения фото мастеров работает автоматически
- Фото мастера отображаются в карточке мастера
- Модальное окно для просмотра всех фото работ мастера

## Как это работает

1. **Мастер загружает фото:**
   - Мастер заходит в личный кабинет → вкладка "Профиль"
   - Нажимает "Загрузить фото" и выбирает изображения
   - Фото сохраняются в MinIO и метаданные в таблицу `masters`
   - Если у мастера нет записи в таблице `masters`, она создается автоматически

2. **Фото отображаются на странице салона:**
   - Когда клиент заходит на страницу салона (`/booking?userId=X`)
   - API `/api/masters/:userId` получает всех мастеров салона
   - Для мастеров, добавленных через `salon_masters`, берется их запись мастера
   - Фото из записи мастера автоматически включаются в ответ
   - Фронтенд отображает фото в карточках мастеров

## Особенности реализации

1. **Автоматическое создание записи мастера:**
   - При первой загрузке фото создается запись в таблице `masters`
   - Запись связывается с пользователем-мастером через `master_user_id`

2. **Синхронизация фото между салонами:**
   - Фото сохраняются один раз в записи мастера
   - Отображаются на всех страницах салонов, где мастер работает
   - Нет дублирования фото в БД

3. **Оптимизация:**
   - Фото проверяются на существование в MinIO перед отображением
   - Поддержка альтернативных путей для совместимости

## Использование

### Для мастера:

1. Войдите в личный кабинет мастера (`/master`)
2. Перейдите на вкладку "Профиль"
3. Прокрутите до секции "Фото моих работ"
4. Нажмите "Загрузить фото" и выберите изображения (JPEG, PNG, WebP)
5. Фото будут автоматически загружены и сохранены

### Для клиентов:

1. Зайдите на страницу салона (`/booking?userId=X`)
2. В секции "Мастера" найдите мастера
3. Если у мастера есть фото работ, карточка будет кликабельной
4. Нажмите на карточку мастера, чтобы открыть галерею фото

## Технические детали

- Максимальный размер файла: 10 МБ
- Максимальное количество файлов за раз: 10
- Поддерживаемые форматы: JPEG, PNG, WebP
- Хранилище: MinIO (объектное хранилище)
- Метаданные: PostgreSQL (таблица `masters`, поле `photos` JSONB)


# База данных SQLite

Система теперь использует SQLite вместо JSON файлов для хранения данных.

## Установка

Установите зависимость:

```bash
npm install better-sqlite3
```

## Миграция данных

При первом запуске система автоматически:
1. Создаст базу данных `data/beauty_studio.db`
2. Создаст все необходимые таблицы
3. Мигрирует данные из старых JSON файлов (если они существуют)

## Структура базы данных

### Таблица `users`
- `id` - уникальный идентификатор
- `username` - имя пользователя (уникальное)
- `email` - email
- `password` - хеш пароля
- `role` - роль (admin/user)
- `is_active` - активен ли аккаунт (1/0)
- `salon_name` - название салона
- `salon_address` - адрес салона
- `salon_lat` - широта
- `salon_lng` - долгота
- `created_at` - дата создания

### Таблица `services`
- `id` - уникальный идентификатор
- `user_id` - ID пользователя (внешний ключ)
- `name` - название услуги
- `price` - цена
- `duration` - длительность в минутах

### Таблица `masters`
- `id` - уникальный идентификатор
- `user_id` - ID пользователя (внешний ключ)
- `name` - имя мастера
- `role` - специализация

### Таблица `bookings`
- `id` - уникальный идентификатор
- `user_id` - ID пользователя (внешний ключ)
- `name` - имя клиента
- `phone` - телефон
- `service` - услуга
- `master` - мастер
- `date` - дата
- `time` - время начала
- `end_time` - время окончания
- `comment` - комментарий
- `created_at` - дата создания записи

## Преимущества SQLite

1. **Надежность** - транзакции и целостность данных
2. **Производительность** - быстрее чем JSON файлы
3. **Масштабируемость** - лучше работает с большим количеством данных
4. **Индексы** - быстрый поиск по датам и пользователям
5. **Каскадное удаление** - автоматическое удаление связанных данных

## Резервное копирование

База данных находится в файле `data/beauty_studio.db`. Для резервного копирования просто скопируйте этот файл.

## Миграция обратно на JSON

Если нужно вернуться на JSON (не рекомендуется), можно:
1. Экспортировать данные из SQLite
2. Преобразовать в JSON формат
3. Изменить код для работы с JSON

## Управление БД

Для просмотра и управления базой данных можно использовать:
- **DB Browser for SQLite** - графический редактор
- **SQLite CLI** - командная строка
- **VS Code расширения** - SQLite Viewer

## Важно

- Старые JSON файлы (`users.json`, `bookings.json`) больше не используются
- Данные автоматически мигрируются при первом запуске
- После миграции можно удалить старые JSON файлы (но лучше оставить как резервную копию)


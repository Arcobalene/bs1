# Telegram –ë–æ—Ç –¥–ª—è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –°–∞–ª–æ–Ω–æ–≤ –ö—Ä–∞—Å–æ—Ç—ã

Telegram-–±–æ—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏ —Å–∞–ª–æ–Ω–æ–≤ –∫—Ä–∞—Å–æ—Ç—ã (—Å–∞–π—Ç: clientix.uz).

## –§—É–Ω–∫—Ü–∏–∏

‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Å–≤–µ—Ä–∫–∞ —Å –±–∞–∑–æ–π —Å–∞–π—Ç–∞)  
‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö, –æ—Ç–º–µ–Ω–∞—Ö, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è—Ö  
‚úÖ –†–∞–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö Telegram (–≤–ª–∞–¥–µ–ª—å—Ü—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—ã)  
‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–π (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
npm install
```

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:**
```bash
cp .env.example .env
```

3. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ —É–∫–∞–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
```
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
```

## –ó–∞–ø—É—Å–∫

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:
```bash
npm start
# –∏–ª–∏
node bot.js
```

### –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
```bash
npm run server
# –∏–ª–∏
node server.js
```

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π):
```bash
npm run dev
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
4. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–∞—à –Ω–æ–º–µ—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–∞–π—Ç–∞ –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–∞—Å

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É Telegram
2. –°–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/setup_group` –≤ –≥—Ä—É–ø–ø–µ
4. –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

**–í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö:**
- `/start` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `/myinfo` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ
- `/chats` - –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤
- `/test` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- `/help` - –°–ø—Ä–∞–≤–∫–∞

**–í –≥—Ä—É–ø–ø–∞—Ö:**
- `/setup_group` - –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø—É –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º

## –í–µ–±—Ö—É–∫–∏ –æ—Ç —Å–∞–π—Ç–∞

–í–µ–±-—Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

### POST /webhook/booking
–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å

```json
{
  "salon_phone": "998903175511",
  "booking_data": {
    "client_name": "–ò–≤–∞–Ω",
    "service": "–°—Ç—Ä–∏–∂–∫–∞",
    "date": "15 —è–Ω–≤–∞—Ä—è",
    "time": "14:00",
    "client_phone": "+998901234567",
    "master": "–ú–∞—Ä–∏—è",
    "comment": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è"
  }
}
```

### POST /webhook/cancel
–û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏

```json
{
  "salon_phone": "998903175511",
  "booking_data": {
    "client_name": "–ò–≤–∞–Ω",
    "service": "–°—Ç—Ä–∏–∂–∫–∞",
    "date": "15 —è–Ω–≤–∞—Ä—è",
    "time": "14:00",
    "reason": "–û—Ç–º–µ–Ω–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–º"
  }
}
```

### POST /webhook/reminder
–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–ø–∏—Å–∏

```json
{
  "salon_phone": "998903175511",
  "booking_data": {
    "client_name": "–ò–≤–∞–Ω",
    "service": "–°—Ç—Ä–∏–∂–∫–∞",
    "date": "15 —è–Ω–≤–∞—Ä—è",
    "time": "14:00"
  }
}
```

### POST /webhook/test
–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

```json
{
  "salon_phone": "998903175511"
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∞–π—Ç–æ–º

### –¢–æ—á–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

–í —Ñ–∞–π–ª–µ `bot.js` —Ñ—É–Ω–∫—Ü–∏—è `checkPhoneInDatabase()` —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–ª—É—à–∫—É. 

**–ó–∞–º–µ–Ω–∏—Ç–µ –µ—ë –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:**

1. **–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL**
```javascript
const { Pool } = require('pg');
const pool = new Pool({ connectionString: process.env.DATABASE_URL });

function checkPhoneInDatabase(phone, callback) {
  const normalized = normalizePhone(phone);
  pool.query(
    'SELECT id, username as name, salon_name FROM users WHERE salon_phone = $1',
    [normalized]
  )
  .then(result => callback(result.rows[0] || null, null))
  .catch(err => callback(null, err));
}
```

2. **–í–∞—Ä–∏–∞–Ω—Ç 2: REST API**
```javascript
const axios = require('axios');

function checkPhoneInDatabase(phone, callback) {
  const normalized = normalizePhone(phone);
  axios.post(`${process.env.CLIENTIX_API_URL}/check-phone`, {
    phone: normalized
  }, {
    headers: { 'Authorization': `Bearer ${process.env.CLIENTIX_API_KEY}` }
  })
  .then(res => callback(res.data.owner || null, null))
  .catch(err => callback(null, err));
}
```

### –¢–æ—á–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –Ω–∞ —Å–∞–π—Ç–µ

–ù–∞ —Å–∞–π—Ç–µ clientix.uz –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É POST –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞:
- `http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä:3000/webhook/booking` - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
- `http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä:3000/webhook/cancel` - –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–∏—Å–∏
- `http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä:3000/webhook/reminder` - –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (`bot.db`):

- **owners** - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–ª–∞–¥–µ–ª—å—Ü—ã —Å–∞–ª–æ–Ω–æ–≤
- **group_chats** - –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
- **notifications** - –ª–æ–≥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Node.js
- Telegraf (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Telegram –±–æ—Ç–æ–≤)
- SQLite3 (–ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- Express (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤)

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC


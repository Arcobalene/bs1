<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî Beauty Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
<header>
  <div class="header-top-links">
    <a href="/users" id="users-link" class="header-top-link" title="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
      </svg>
    </a>
    <a href="#" id="logout-link" class="logout-link" title="–í—ã—Ö–æ–¥">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M16 17v-3h-5v-4h5V7l5 5-5 5zM14 2a2 2 0 012 2v2h-2V4H5v16h11v-2h2v2a2 2 0 01-2 2H5a2 2 0 01-2-2V4a2 2 0 012-2h9z"/>
      </svg>
    </a>
  </div>
  <h1>Beauty Studio</h1>
  <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–ª–æ–Ω–æ–º</p>
  <div class="nav-links">
    <a href="/booking" id="salon-page-link">–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–ª–æ–Ω–∞</a>
    <a href="/admin">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
    <a href="/calendar">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
    <a href="/services">–£—Å–ª—É–≥–∏ –∏ –º–∞—Å—Ç–µ—Ä–∞</a>
    <a href="/clients">–ö–ª–∏–µ–Ω—Ç—ã</a>
  </div>
</header>

<div class="container">
  <div id="impersonation-banner" class="card" style="background: #fef3c7; border: 2px solid #fbbf24; margin-bottom: 16px; display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <strong>‚ö†Ô∏è –í—ã –≤–æ—à–ª–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: <span id="impersonated-user"></span></strong>
        <p style="margin: 4px 0 0 0; font-size: 0.85rem;">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç: <span id="original-user"></span></p>
      </div>
      <button id="restore-account" class="btn-secondary" style="margin: 0;">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É</button>
    </div>
  </div>

  <div class="user-info">
    <h3 id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
    <p id="user-email"></p>
    <p class="note">–í–∞—à–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏: <strong id="booking-link"></strong></p>
  </div>

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Telegram –±–æ—Ç–µ (–¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º) -->
  <div class="card" style="margin-bottom: 24px;">
    <div style="padding: 16px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px;">
      <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
        <div style="flex: 1;">
          <strong style="font-size: 1.1rem; color: #0c4a6e;">Telegram –±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</strong>
          <p style="margin: 8px 0 0 0; color: #075985; font-size: 0.9rem;">–ü–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö, –æ—Ç–º–µ–Ω–∞—Ö –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –ø—Ä—è–º–æ –≤ Telegram</p>
        </div>
        <button type="button" class="btn-primary" id="telegram-bot-info-btn">–û –±–æ—Ç–µ</button>
      </div>
    </div>
  </div>

  <!-- –ì–ª–∞–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
  <div class="main-tabs">
    <button class="main-tab-button active" data-main-tab="salon-info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ</button>
    <button class="main-tab-button" data-main-tab="design">–î–∏–∑–∞–π–Ω</button>
    <button class="main-tab-button" data-main-tab="telegram-integration" id="telegram-tab-button" style="display: none;">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram</button>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ -->
  <div class="main-tab-content active" id="salon-info-tab">
  <div class="card">
    <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ</h2>
    <p class="description">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∞–ª–æ–Ω–∞ –∏ —É–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ.</p>

    <form id="salon-form">
      <div>
        <label for="salon-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–ª–æ–Ω–∞</label>
        <input type="text" id="salon-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Beauty Studio" />
      </div>

      <div>
        <label for="salon-address">–ê–¥—Ä–µ—Å —Å–∞–ª–æ–Ω–∞</label>
        <input type="text" id="salon-address" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 10" />
        <p class="note">–ê–¥—Ä–µ—Å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ –∏ –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∞–ª–æ–Ω–µ</p>
      </div>

      <div>
        <label for="salon-phone">–¢–µ–ª–µ—Ñ–æ–Ω –≤–ª–∞–¥–µ–ª—å—Ü–∞ *</label>
        <input type="tel" id="salon-phone" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +998XX XXX XX XX" />
        <p class="note">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram. –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</p>
      </div>

      <div>
        <label for="salon-display-phone">–¢–µ–ª–µ—Ñ–æ–Ω —Å–∞–ª–æ–Ω–∞ (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)</label>
        <input type="tel" id="salon-display-phone" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +998XX XXX XX XX" />
        <p class="note">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å–∞–ª–æ–Ω–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
      </div>

      <div>
        <label>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∞–ª–æ–Ω–∞</label>
        <div class="form-row">
          <div>
            <label for="work-hours-start">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</label>
            <input type="number" id="work-hours-start" min="0" max="23" value="10" />
            <p class="note">–ß–∞—Å –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã (0-23)</p>
          </div>
          <div>
            <label for="work-hours-end">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã</label>
            <input type="number" id="work-hours-end" min="0" max="23" value="20" />
            <p class="note">–ß–∞—Å –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã (0-23)</p>
          </div>
        </div>
        <p class="note">–≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10:00 - 20:00</p>
      </div>

      <div>
        <label>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ</label>
        <div id="map" style="width: 100%; height: 400px; border-radius: 10px; margin-top: 8px;"></div>
        <p class="note">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–∞–ª–æ–Ω–∞</p>
        <input type="hidden" id="salon-lat" />
        <input type="hidden" id="salon-lng" />
      </div>

      <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∞–ª–æ–Ω–µ</button>
      <div id="salon-alert" class="alert" style="display: none;"></div>
    </form>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞: –î–∏–∑–∞–π–Ω -->
  <div class="main-tab-content" id="design-tab" style="display: none;">
    <div class="card">
      <h2>–î–∏–∑–∞–π–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–ª–æ–Ω–∞</h2>
      <p class="description">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã –∏ –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∞—à–µ–≥–æ —Å–∞–ª–æ–Ω–∞.</p>

      <form id="design-form">
        <div class="tabs">
          <button type="button" class="tab-button active" data-tab="colors">–¶–≤–µ—Ç–∞</button>
          <button type="button" class="tab-button" data-tab="header">–ó–∞–≥–æ–ª–æ–≤–æ–∫</button>
          <button type="button" class="tab-button" data-tab="preview">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
        </div>

        <div class="tab-content" id="colors-tab">
          <div class="form-row">
      <div>
              <label for="design-primary-color">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</label>
              <input type="color" id="design-primary-color" value="#f973b6" />
              <p class="note">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏ –∞–∫—Ü–µ–Ω—Ç–æ–≤</p>
            </div>
            <div>
              <label for="design-secondary-color">–í—Ç–æ—Ä–∏—á–Ω—ã–π —Ü–≤–µ—Ç</label>
              <input type="color" id="design-secondary-color" value="#a855f7" />
              <p class="note">–í—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞</p>
            </div>
      </div>
      <div class="form-row">
        <div>
              <label for="design-header-bg">–§–æ–Ω –∑–∞–≥–æ–ª–æ–≤–∫–∞</label>
              <input type="color" id="design-header-bg" value="#f973b6" />
              <p class="note">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ —à–∞–ø–∫–∏</p>
        </div>
        <div>
              <label for="design-card-bg">–§–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫</label>
              <input type="color" id="design-card-bg" value="#ffffff" />
              <p class="note">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–µ–∫</p>
        </div>
      </div>
      <div>
        <label for="design-header-opacity">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∞: <span id="header-opacity-value">25</span>%</label>
        <input type="range" id="design-header-opacity" min="0" max="100" value="25" step="5" />
        <p class="note">–†–µ–≥—É–ª–∏—Ä—É–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (0% - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π, 100% - –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π)</p>
      </div>
          <div>
            <label for="design-text-color">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
            <input type="color" id="design-text-color" value="#222222" />
            <p class="note">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</p>
          </div>
          <div>
            <label for="design-button-text-color">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ –∫–Ω–æ–ø–∫–∞—Ö</label>
            <input type="color" id="design-button-text-color" value="#ffffff" />
            <p class="note">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ –∫–Ω–æ–ø–∫–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–ª—ã–π)</p>
          </div>
          <div>
            <label for="design-page-bg">–§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã</label>
            <input type="color" id="design-page-bg" value="#f7f7fb" />
            <p class="note">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã</p>
          </div>
          <div>
            <label for="design-page-bg-type">–¢–∏–ø —Ñ–æ–Ω–∞</label>
            <select id="design-page-bg-type">
              <option value="color">–û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç</option>
              <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
              <option value="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</option>
            </select>
            <p class="note">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ñ–æ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</p>
          </div>
          <div id="design-page-bg-gradient" style="display: none;">
            <label for="design-page-bg-secondary">–í—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞</label>
            <input type="color" id="design-page-bg-secondary" value="#ffffff" />
            <p class="note">–í—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞</p>
          </div>
          <div id="design-page-bg-image" style="display: none;">
            <label for="design-page-bg-image-url">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
            <input type="text" id="design-page-bg-image-url" placeholder="https://example.com/image.jpg" />
            <p class="note">–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ñ–æ–Ω–∞</p>
          </div>
  </div>

        <div class="tab-content" id="header-tab" style="display: none;">
          <h3 style="margin-bottom: 16px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</h3>
          
          <div>
            <label for="design-header-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–ª–æ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ</label>
            <input type="text" id="design-header-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Beauty Studio" />
            <p class="note">–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∞–ª–æ–Ω–µ</p>
          </div>
          
          <div>
            <label for="design-header-title">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
            <input type="text" id="design-header-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à —Å–∞–ª–æ–Ω" />
            <p class="note">–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å–∞–ª–æ–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</p>
          </div>
          
          <div>
            <label for="design-header-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="design-header-description" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ —Å–∞–ª–æ–Ω–∞..." rows="3"></textarea>
            <p class="note">–û—Å–Ω–æ–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∞–ª–æ–Ω–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–¥ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–º</p>
          </div>
          
          <div class="divider" style="margin: 24px 0;"></div>
          
          <h3 style="margin-bottom: 16px;">–°—Ç–∏–ª—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</h3>
          
          <div class="form-row">
            <div>
              <label for="design-header-name-size">–†–∞–∑–º–µ—Ä –Ω–∞–∑–≤–∞–Ω–∏—è</label>
              <select id="design-header-name-size">
                <option value="normal">–û–±—ã—á–Ω—ã–π</option>
                <option value="large">–ë–æ–ª—å—à–æ–π</option>
                <option value="xlarge">–û—á–µ–Ω—å –±–æ–ª—å—à–æ–π</option>
                <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
              </select>
              <p class="note">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–∞–ª–æ–Ω–∞</p>
            </div>
            <div>
              <label for="design-header-name-color">–¶–≤–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è</label>
              <input type="color" id="design-header-name-color" value="#ffffff" />
              <p class="note">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–∞–ª–æ–Ω–∞</p>
            </div>
          </div>
          
          <div class="form-row">
            <div>
              <label for="design-header-title-size">–†–∞–∑–º–µ—Ä –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞</label>
              <select id="design-header-title-size">
                <option value="normal">–û–±—ã—á–Ω—ã–π</option>
                <option value="large">–ë–æ–ª—å—à–æ–π</option>
                <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
              </select>
              <p class="note">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞</p>
            </div>
            <div>
              <label for="design-header-title-color">–¶–≤–µ—Ç –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞</label>
              <input type="color" id="design-header-title-color" value="#ffffff" />
              <p class="note">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞</p>
            </div>
          </div>
          
          <div class="form-row">
            <div>
              <label for="design-header-description-size">–†–∞–∑–º–µ—Ä –æ–ø–∏—Å–∞–Ω–∏—è</label>
              <select id="design-header-description-size">
                <option value="normal">–û–±—ã—á–Ω—ã–π</option>
                <option value="large">–ë–æ–ª—å—à–æ–π</option>
                <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
              </select>
              <p class="note">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –æ–ø–∏—Å–∞–Ω–∏—è</p>
            </div>
            <div>
              <label for="design-header-description-color">–¶–≤–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è</label>
              <input type="color" id="design-header-description-color" value="#ffffff" />
              <p class="note">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –æ–ø–∏—Å–∞–Ω–∏—è</p>
            </div>
          </div>
          
          <div class="divider" style="margin: 24px 0;"></div>
          
          <h3 style="margin-bottom: 16px;">–ù–∞–∑–≤–∞–Ω–∏—è —Å–µ–∫—Ü–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</h3>
          <p class="note" style="margin-bottom: 16px;">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å–µ–∫—Ü–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–∞–ª–æ–Ω–∞</p>
          
          <div class="form-row">
            <div>
              <label for="design-section-services">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ "–£—Å–ª—É–≥–∏"</label>
              <input type="text" id="design-section-services" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—Å–ª—É–≥–∏" />
              <p class="note">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ —É—Å–ª—É–≥</p>
            </div>
            <div>
              <label for="design-section-masters">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ "–ú–∞—Å—Ç–µ—Ä–∞"</label>
              <input type="text" id="design-section-masters" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã" />
              <p class="note">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –º–∞—Å—Ç–µ—Ä–æ–≤</p>
            </div>
          </div>
          
          <div class="form-row">
            <div>
              <label for="design-section-booking">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ "–û–Ω–ª–∞–π–Ω –∑–∞–ø–∏—Å—å"</label>
              <input type="text" id="design-section-booking" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–Ω–ª–∞–π–Ω –∑–∞–ø–∏—Å—å" />
              <p class="note">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–æ—Ä–º—ã –∑–∞–ø–∏—Å–∏</p>
            </div>
            <div>
              <label for="design-section-location">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ "–ö–∞–∫ –Ω–∞—Å –Ω–∞–π—Ç–∏"</label>
              <input type="text" id="design-section-location" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞–∫ –Ω–∞—Å –Ω–∞–π—Ç–∏" />
              <p class="note">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ —Å –∫–∞—Ä—Ç–æ–π</p>
            </div>
          </div>
          
          <div class="form-row">
            <div>
              <label for="design-label-master">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è "–ú–∞—Å—Ç–µ—Ä"</label>
              <input type="text" id="design-label-master" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç" />
              <p class="note">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è –≤—ã–±–æ—Ä–∞ –º–∞—Å—Ç–µ—Ä–∞ –≤ —Ñ–æ—Ä–º–µ</p>
            </div>
            <div>
              <label for="design-option-any-master">–¢–µ–∫—Å—Ç "–õ—é–±–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Å—Ç–µ—Ä"</label>
              <input type="text" id="design-option-any-master" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ—é–±–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç" />
              <p class="note">–¢–µ–∫—Å—Ç –æ–ø—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –ª—é–±–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞</p>
            </div>
          </div>
          
          <div class="divider" style="margin: 24px 0;"></div>
          
          <h3 style="margin-bottom: 16px;">–õ–æ–≥–æ—Ç–∏–ø</h3>
          
          <div>
            <label for="design-logo">–õ–æ–≥–æ—Ç–∏–ø</label>
            <input type="file" id="design-logo" accept="image/*" />
            <p class="note">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ª–æ–≥–æ—Ç–∏–ø –≤–∞—à–µ–≥–æ —Å–∞–ª–æ–Ω–∞ (PNG, JPG, SVG, –º–∞–∫—Å–∏–º—É–º 2MB)</p>
            <div id="logo-preview" style="margin-top: 12px; display: none;">
              <img id="logo-preview-img" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ—Ç–∏–ø–∞" style="max-width: 200px; max-height: 100px; border-radius: 8px; border: 1px solid #e5e7eb;" />
              <button type="button" id="remove-logo-btn" class="btn-secondary" style="margin-left: 8px; margin-top: 8px;">–£–¥–∞–ª–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø</button>
            </div>
            <div id="current-logo" style="margin-top: 12px; display: none;">
              <p style="margin-bottom: 8px; font-weight: 500;">–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø:</p>
              <img id="current-logo-img" src="" alt="–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø" style="max-width: 200px; max-height: 100px; border-radius: 8px; border: 1px solid #e5e7eb;" />
            </div>
          </div>
        </div>

        <div class="tab-content" id="preview-tab" style="display: none;">
          <div style="background: linear-gradient(135deg, #f973b6, #a855f7); color: white; padding: 24px; border-radius: 12px; margin-bottom: 16px;">
            <h3 id="preview-title" style="margin: 0 0 8px 0; font-size: 2.4rem; color: #ffffff;">Beauty Studio</h3>
            <p id="preview-description" style="margin: 0; opacity: 0.9; font-size: 1rem; color: #ffffff;">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞</p>
          </div>
          <div style="background: white; padding: 16px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <p style="margin: 0; color: #222;">–ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏</p>
            <button type="button" id="preview-button" style="margin-top: 12px; padding: 8px 16px; border: none; border-radius: 999px; color: white; cursor: pointer;">–ü—Ä–∏–º–µ—Ä –∫–Ω–æ–ø–∫–∏</button>
          </div>
        </div>

        <div style="margin-top: 16px;">
          <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
          <button type="button" class="btn-secondary" id="reset-design-btn" style="margin-left: 8px;">–°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é</button>
        </div>
        <div id="design-alert" class="alert" style="display: none; margin-top: 12px;"></div>
      </form>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
  <div class="main-tab-content" id="telegram-integration-tab" style="display: none;">
    <div class="card">
      <h2>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram</h2>
      <p class="description">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ Telegram –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö, –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏ –æ—Ç–º–µ–Ω–∞—Ö.</p>

      <div id="telegram-status-section" style="margin-bottom: 24px;">
        <div style="padding: 20px; background: #f3f4f6; border-radius: 8px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
            <div>
              <strong style="font-size: 1.1rem;">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</strong>
              <span id="telegram-status-text" style="margin-left: 8px; font-weight: normal;">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div id="telegram-status-badge" style="padding: 6px 16px; border-radius: 16px; font-size: 0.875rem; font-weight: 500; background: #9ca3af; color: #fff;">
              –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
          </div>
          <div id="telegram-actions" style="display: flex; gap: 8px; flex-wrap: wrap;">
            <button type="button" class="btn-primary" id="telegram-connect-btn" style="display: none;">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram</button>
            <button type="button" class="btn-secondary" id="telegram-reconnect-btn" style="display: none;">–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å</button>
            <button type="button" class="btn-secondary" id="telegram-disconnect-btn" style="display: none;">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
          </div>
        </div>
      </div>

      <form id="telegram-form">
        <h3 style="margin-bottom: 16px; font-size: 1.1rem;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞</h3>
        
        <div style="margin-bottom: 20px;">
          <label for="telegram-bot-token">–¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞</label>
          <input type="password" id="telegram-bot-token" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz)" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; font-family: monospace;" />
          <p class="note">–¢–æ–∫–µ–Ω –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É @BotFather –≤ Telegram. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.</p>
        </div>

        <div class="divider" style="margin: 24px 0;"></div>
        
        <h3 style="margin-bottom: 16px; font-size: 1.1rem;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
        
        <div style="margin-bottom: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="telegram-enabled" style="width: 18px; height: 18px; cursor: pointer;" />
            <span>–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram</span>
          </label>
          <p class="note" style="margin-left: 26px; margin-top: 4px;">–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏</p>
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="telegram-notify-new-bookings" style="width: 18px; height: 18px; cursor: pointer;" />
            <span>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö</span>
          </label>
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="telegram-notify-cancellations" style="width: 18px; height: 18px; cursor: pointer;" />
            <span>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ–± –æ—Ç–º–µ–Ω–∞—Ö –∑–∞–ø–∏—Å–µ–π</span>
          </label>
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="telegram-notify-changes" style="width: 18px; height: 18px; cursor: pointer;" />
            <span>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∑–∞–ø–∏—Å—è—Ö</span>
          </label>
        </div>

        <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <div id="telegram-alert" class="alert" style="display: none; margin-top: 16px;"></div>
      </form>

      <div style="margin-top: 24px; padding: 20px; background: #f3f4f6; border-radius: 8px;">
        <h3 style="margin-bottom: 16px; font-size: 1.1rem;">–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Telegram:</h3>
        <ol style="margin-left: 20px; line-height: 2; color: #374151;">
          <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∞–ª–æ–Ω–∞ (–≤–∫–ª–∞–¥–∫–∞ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ") —É–∫–∞–∑–∞–Ω –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</li>
          <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram" –≤—ã—à–µ</li>
          <li>–û—Ç–∫—Ä–æ–µ—Ç—Å—è Telegram —Å –±–æ—Ç–æ–º - –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç"</li>
          <li>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –≤–∞—à–µ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</li>
          <li>–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–ø–∏—Å—è—Ö</li>
        </ol>
        <div style="margin-top: 16px; padding: 12px; background: #fff; border-radius: 6px; border-left: 4px solid #3b82f6;">
          <p style="margin: 0; color: #1f2937; font-size: 0.875rem;">
            <strong>–í–∞–∂–Ω–æ:</strong> –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ Telegram –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–æ–º–µ—Ä–æ–º, —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∞–ª–æ–Ω–∞. –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –ø—Ä–∏–≤—è–∑–∫–∞ –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Telegram –±–æ—Ç–µ -->
  <div id="telegram-bot-info-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 12px; padding: 32px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="margin: 0; font-size: 1.5rem; color: #1f2937;">–û Telegram –±–æ—Ç–µ</h2>
        <button type="button" id="telegram-bot-info-modal-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">√ó</button>
      </div>

      <div style="margin-bottom: 24px;">
        <h3 style="margin: 0 0 12px 0; font-size: 1.2rem; color: #374151;">–ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç:</h3>
        <ul style="margin: 0; padding-left: 24px; line-height: 1.8; color: #4b5563;">
          <li><strong>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–ø–∏—Å—è—Ö</strong> ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö –≤ –≤–∞—à —Å–∞–ª–æ–Ω</li>
          <li><strong>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Ç–º–µ–Ω–∞—Ö</strong> ‚Äî —Å–æ–æ–±—â–∞–µ—Ç, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ—Ç–º–µ–Ω–∏–ª –∑–∞–ø–∏—Å—å</li>
          <li><strong>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö</strong> ‚Äî –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å—è—Ö</li>
          <li><strong>–†–∞–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö</strong> ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É Telegram –¥–ª—è –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</li>
          <li><strong>–£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</strong> ‚Äî –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–ø–∏—Å–∏</li>
        </ul>
      </div>

      <div style="margin-bottom: 24px; padding: 16px; background: #f3f4f6; border-radius: 8px;">
        <h3 style="margin: 0 0 12px 0; font-size: 1.2rem; color: #374151;">–ö–∞–∫ –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</h3>
        <ol style="margin: 0; padding-left: 24px; line-height: 1.8; color: #4b5563;">
          <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –±–æ—Ç–∞ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –µ–≥–æ –≤ Telegram</li>
          <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å" –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code style="background: white; padding: 2px 6px; border-radius: 4px; font-family: monospace;">/start</code></li>
          <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É—è –∫–Ω–æ–ø–∫—É "üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"</li>
          <li>–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã –Ω–∞—á–Ω–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
        </ol>
      </div>

      <div style="margin-bottom: 24px;">
        <h3 style="margin: 0 0 12px 0; font-size: 1.2rem; color: #374151;">–°—Å—ã–ª–∫–∞ –Ω–∞ –±–æ—Ç–∞:</h3>
        <div id="telegram-bot-link-container" style="padding: 16px; background: #f9fafb; border: 2px dashed #d1d5db; border-radius: 8px; text-align: center;">
          <p id="telegram-bot-link-loading" style="margin: 0; color: #6b7280;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ...</p>
          <a id="telegram-bot-link" href="#" target="_blank" style="display: none; font-size: 1.1rem; font-weight: 600; color: #0ea5e9; text-decoration: none; padding: 12px 24px; background: white; border-radius: 8px; border: 2px solid #0ea5e9; display: inline-block; transition: all 0.2s;" onmouseover="this.style.background='#0ea5e9'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#0ea5e9'">
            üì± –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram
          </a>
          <p id="telegram-bot-link-error" style="display: none; margin: 12px 0 0 0; color: #ef4444; font-size: 0.9rem;">
            –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.
          </p>
        </div>
      </div>

      <div style="padding: 16px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 6px;">
        <p style="margin: 0; color: #92400e; font-size: 0.9rem;">
          <strong>–í–∞–∂–Ω–æ:</strong> –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ Telegram –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞, —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∞–ª–æ–Ω–∞ (–≤–∫–ª–∞–¥–∫–∞ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ"). –ï—Å–ª–∏ –Ω–æ–º–µ—Ä–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.
        </p>
      </div>
    </div>
  </div>
</div>

<footer>
  ¬© 2025 Beauty Studio. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
</footer>

<script src="https://api-maps.yandex.ru/2.1/?apikey=YOUR_API_KEY&lang=ru_RU" type="text/javascript"></script>
<script>
  let currentUser = null;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  async function loadUserData() {
    try {
      const response = await fetch('/api/user', {
        credentials: 'include'
      });
      const result = await response.json();
      
      if (!result.success) {
        window.location.href = '/';
        return;
      }

      currentUser = result.user;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–æ—à–ª–∏ –ª–∏ –º—ã –ø–æ–¥ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
      if (currentUser.isImpersonating) {
        const banner = document.getElementById('impersonation-banner');
        if (banner) {
          banner.style.display = 'block';
          document.getElementById('impersonated-user').textContent = currentUser.username;
          document.getElementById('original-user').textContent = currentUser.originalUsername;
        }
      }

      document.getElementById('user-name').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.username}!`;
      document.getElementById('user-email').textContent = currentUser.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω';
      const bookingLink = `${window.location.origin}/booking?userId=${currentUser.id}`;
      document.getElementById('booking-link').textContent = bookingLink;
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É "–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–ª–æ–Ω–∞" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      const salonPageLink = document.getElementById('salon-page-link');
      if (salonPageLink) {
        salonPageLink.href = `/booking?userId=${currentUser.id}`;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
      const usersLink = document.getElementById('users-link');
      const isAdmin = currentUser.role === 'admin' || currentUser.username === 'admin';
      if (usersLink) {
        if (isAdmin) {
          usersLink.classList.add('show');
        } else {
          usersLink.classList.remove('show');
        }
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Telegram —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
      const telegramTabButton = document.getElementById('telegram-tab-button');
      if (telegramTabButton) {
        if (isAdmin) {
          telegramTabButton.style.display = 'inline-block';
        } else {
          telegramTabButton.style.display = 'none';
        }
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º currentUser –≤ window –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
      window.currentUser = currentUser;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∞–ª–æ–Ω–µ
      loadSalonInfo();
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–∏–∑–∞–π–Ω
      if (currentUser.salonDesign) {
        applyDesign(currentUser.salonDesign);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
      window.location.href = '/';
    }
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–æ–º
  let designSettings = {
    primaryColor: '#f973b6',
    secondaryColor: '#a855f7',
    headerBg: '#f973b6',
    headerOpacity: 25,
    cardBg: '#ffffff',
    textColor: '#222222',
    buttonTextColor: '#ffffff',
    pageBg: '#f7f7fb',
    pageBgType: 'color',
    pageBgSecondary: '#ffffff',
    pageBgImage: '',
    logo: '',
    headerName: '',
    headerTitle: '',
    headerDescription: '',
    headerNameSize: 'normal',
    headerNameColor: '#ffffff',
    headerTitleSize: 'normal',
    headerTitleColor: '#ffffff',
    headerDescriptionSize: 'normal',
    headerDescriptionColor: '#ffffff',
    sectionServices: '',
    sectionMasters: '',
    sectionBooking: '',
    sectionLocation: '',
    labelMaster: '',
    optionAnyMaster: ''
  };

  // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–∏–∑–∞–π–Ω–∞
  async function loadDesignSettings() {
    try {
      const response = await fetch('/api/salon/design', {
        credentials: 'include'
      });
      const result = await response.json();
      if (result.success && result.design) {
        designSettings = { ...designSettings, ...result.design };
        applyDesignToForm();
        updatePreview();
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–∏–∑–∞–π–Ω–∞:', error);
    }
  }

  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫ —Ñ–æ—Ä–º–µ
  function applyDesignToForm() {
    document.getElementById('design-primary-color').value = designSettings.primaryColor || '#f973b6';
    document.getElementById('design-secondary-color').value = designSettings.secondaryColor || '#a855f7';
    document.getElementById('design-header-bg').value = designSettings.headerBg || '#f973b6';
    const headerOpacityValue = designSettings.headerOpacity !== undefined ? designSettings.headerOpacity : 25;
    document.getElementById('design-header-opacity').value = headerOpacityValue;
    document.getElementById('header-opacity-value').textContent = headerOpacityValue;
    document.getElementById('design-card-bg').value = designSettings.cardBg || '#ffffff';
    document.getElementById('design-text-color').value = designSettings.textColor || '#222222';
    document.getElementById('design-button-text-color').value = designSettings.buttonTextColor || '#ffffff';
    document.getElementById('design-page-bg').value = designSettings.pageBg || '#f7f7fb';
    document.getElementById('design-page-bg-type').value = designSettings.pageBgType || 'color';
    document.getElementById('design-page-bg-secondary').value = designSettings.pageBgSecondary || '#ffffff';
    document.getElementById('design-page-bg-image-url').value = designSettings.pageBgImage || '';
    document.getElementById('design-header-name').value = designSettings.headerName || '';
    document.getElementById('design-header-title').value = designSettings.headerTitle || '';
    document.getElementById('design-header-description').value = designSettings.headerDescription || '';
    document.getElementById('design-header-name-size').value = designSettings.headerNameSize || 'normal';
    document.getElementById('design-header-name-color').value = designSettings.headerNameColor || '#ffffff';
    document.getElementById('design-header-title-size').value = designSettings.headerTitleSize || 'normal';
    document.getElementById('design-header-title-color').value = designSettings.headerTitleColor || '#ffffff';
    document.getElementById('design-header-description-size').value = designSettings.headerDescriptionSize || 'normal';
    document.getElementById('design-header-description-color').value = designSettings.headerDescriptionColor || '#ffffff';
    document.getElementById('design-section-services').value = designSettings.sectionServices || '';
    document.getElementById('design-section-masters').value = designSettings.sectionMasters || '';
    document.getElementById('design-section-booking').value = designSettings.sectionBooking || '';
    document.getElementById('design-section-location').value = designSettings.sectionLocation || '';
    document.getElementById('design-label-master').value = designSettings.labelMaster || '';
    document.getElementById('design-option-any-master').value = designSettings.optionAnyMaster || '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–æ–Ω–∞
    updatePageBgFields();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ header
    const headerOpacitySlider = document.getElementById('design-header-opacity');
    const headerOpacityValueSpan = document.getElementById('header-opacity-value');
    if (headerOpacitySlider && headerOpacityValueSpan) {
      headerOpacitySlider.addEventListener('input', (e) => {
        headerOpacityValueSpan.textContent = e.target.value;
      });
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø, –µ—Å–ª–∏ –µ—Å—Ç—å
    if (designSettings.logo) {
      const currentLogoImg = document.getElementById('current-logo-img');
      const currentLogo = document.getElementById('current-logo');
      if (currentLogoImg && currentLogo) {
        currentLogoImg.src = designSettings.logo;
        currentLogo.style.display = 'block';
      }
    }
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª–µ–π —Ñ–æ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  function updatePageBgFields() {
    const bgType = document.getElementById('design-page-bg-type').value;
    const gradientDiv = document.getElementById('design-page-bg-gradient');
    const imageDiv = document.getElementById('design-page-bg-image');
    
    if (gradientDiv) gradientDiv.style.display = bgType === 'gradient' ? 'block' : 'none';
    if (imageDiv) imageDiv.style.display = bgType === 'image' ? 'block' : 'none';
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  function updatePreview() {
    const primaryColor = document.getElementById('design-primary-color').value;
    const secondaryColor = document.getElementById('design-secondary-color').value;
    const headerBg = document.getElementById('design-header-bg').value;
    const cardBg = document.getElementById('design-card-bg').value;
    const textColor = document.getElementById('design-text-color').value;
    const buttonTextColor = document.getElementById('design-button-text-color').value;
    const headerName = document.getElementById('design-header-name').value || 'Beauty Studio';
    const headerTitle = document.getElementById('design-header-title').value || '';
    const headerDescription = document.getElementById('design-header-description').value || '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞';
    const headerNameColor = document.getElementById('design-header-name-color').value;
    const headerTitleColor = document.getElementById('design-header-title-color').value;
    const headerDescriptionColor = document.getElementById('design-header-description-color').value;

    const previewHeader = document.querySelector('#preview-tab > div:first-child');
    if (previewHeader) {
      previewHeader.style.background = `linear-gradient(135deg, ${headerBg}, ${secondaryColor})`;
    }

    const previewTitle = document.getElementById('preview-title');
    if (previewTitle) {
      previewTitle.textContent = headerName;
      previewTitle.style.color = headerNameColor;
      const nameSize = document.getElementById('design-header-name-size').value;
      const sizeMap = {
        'small': '1.5rem',
        'normal': '2.4rem',
        'large': '3rem',
        'xlarge': '3.5rem'
      };
      previewTitle.style.fontSize = sizeMap[nameSize] || sizeMap.normal;
    }

    const previewDesc = document.getElementById('preview-description');
    if (previewDesc) {
      previewDesc.textContent = headerDescription || headerTitle || '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞';
      previewDesc.style.color = headerDescriptionColor;
      const descSize = document.getElementById('design-header-description-size').value;
      const sizeMap = {
        'small': '0.9rem',
        'normal': '1rem',
        'large': '1.2rem'
      };
      previewDesc.style.fontSize = sizeMap[descSize] || sizeMap.normal;
    }

    const previewCard = document.querySelector('#preview-tab > div:last-child');
    if (previewCard) {
      previewCard.style.background = cardBg;
      previewCard.style.color = textColor;
    }

    const previewButton = document.getElementById('preview-button');
    if (previewButton) {
      previewButton.style.background = `linear-gradient(135deg, ${primaryColor}, ${secondaryColor})`;
      previewButton.style.color = buttonTextColor;
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ —Ñ–æ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  const pageBgTypeSelect = document.getElementById('design-page-bg-type');
  if (pageBgTypeSelect) {
    pageBgTypeSelect.addEventListener('change', updatePageBgFields);
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ—Ç–∏–ø–∞
  const logoInput = document.getElementById('design-logo');
  if (logoInput) {
    logoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        if (file.size > 2 * 1024 * 1024) { // 2MB –ª–∏–º–∏—Ç
          alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 2MB');
          e.target.value = '';
      return;
    }
        
        const reader = new FileReader();
        reader.onload = (event) => {
          const base64 = event.target.result;
          designSettings.logo = base64;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
          const previewImg = document.getElementById('logo-preview-img');
          const previewDiv = document.getElementById('logo-preview');
          if (previewImg && previewDiv) {
            previewImg.src = base64;
            previewDiv.style.display = 'block';
          }
          
          // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø
          const currentLogo = document.getElementById('current-logo');
          if (currentLogo) {
            currentLogo.style.display = 'none';
          }
        };
        reader.readAsDataURL(file);
      }
    });
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞
  const removeLogoBtn = document.getElementById('remove-logo-btn');
  if (removeLogoBtn) {
    removeLogoBtn.addEventListener('click', () => {
      designSettings.logo = '';
      const logoInput = document.getElementById('design-logo');
      const previewDiv = document.getElementById('logo-preview');
      const currentLogo = document.getElementById('current-logo');
      
      if (logoInput) logoInput.value = '';
      if (previewDiv) previewDiv.style.display = 'none';
      if (currentLogo) currentLogo.style.display = 'none';
    });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–≤–µ—Ç–æ–≤
  ['design-primary-color', 'design-secondary-color', 'design-header-bg', 'design-card-bg', 'design-text-color', 'design-button-text-color', 'design-header-name', 'design-header-title', 'design-header-description', 'design-header-name-size', 'design-header-name-color', 'design-header-title-size', 'design-header-title-color', 'design-header-description-size', 'design-header-description-color', 'design-section-services', 'design-section-masters', 'design-section-booking', 'design-section-location', 'design-label-master', 'design-option-any-master', 'design-page-bg', 'design-page-bg-secondary', 'design-page-bg-image-url'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener('input', () => {
        if (document.getElementById('preview-tab').style.display !== 'none') {
          updatePreview();
        }
      });
      el.addEventListener('change', () => {
        if (document.getElementById('preview-tab').style.display !== 'none') {
          updatePreview();
        }
      });
    }
  });

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞
  const designForm = document.getElementById('design-form');
  if (designForm) {
    designForm.addEventListener('submit', async (e) => {
    e.preventDefault();
      const designAlert = document.getElementById('design-alert');
      if (designAlert) designAlert.style.display = 'none';

      const design = {
        primaryColor: document.getElementById('design-primary-color').value,
        secondaryColor: document.getElementById('design-secondary-color').value,
        headerBg: document.getElementById('design-header-bg').value,
        headerOpacity: parseInt(document.getElementById('design-header-opacity').value) || 25,
        cardBg: document.getElementById('design-card-bg').value,
        textColor: document.getElementById('design-text-color').value,
        buttonTextColor: document.getElementById('design-button-text-color').value,
        pageBg: document.getElementById('design-page-bg').value,
        pageBgType: document.getElementById('design-page-bg-type').value,
        pageBgSecondary: document.getElementById('design-page-bg-secondary').value,
        pageBgImage: document.getElementById('design-page-bg-image-url').value.trim(),
        logo: designSettings.logo || '',
        headerName: document.getElementById('design-header-name').value.trim(),
        headerTitle: document.getElementById('design-header-title').value.trim(),
        headerDescription: document.getElementById('design-header-description').value.trim(),
        headerNameSize: document.getElementById('design-header-name-size').value,
        headerNameColor: document.getElementById('design-header-name-color').value,
        headerTitleSize: document.getElementById('design-header-title-size').value,
        headerTitleColor: document.getElementById('design-header-title-color').value,
        headerDescriptionSize: document.getElementById('design-header-description-size').value,
        headerDescriptionColor: document.getElementById('design-header-description-color').value,
        sectionServices: document.getElementById('design-section-services').value.trim(),
        sectionMasters: document.getElementById('design-section-masters').value.trim(),
        sectionBooking: document.getElementById('design-section-booking').value.trim(),
        sectionLocation: document.getElementById('design-section-location').value.trim(),
        labelMaster: document.getElementById('design-label-master').value.trim(),
        optionAnyMaster: document.getElementById('design-option-any-master').value.trim()
      };

      try {
        const response = await fetch('/api/salon/design', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ design }),
          credentials: 'include'
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        if (result.success) {
          designSettings = design;
          if (designAlert) {
            designAlert.className = 'alert alert-success';
            designAlert.textContent = '–î–∏–∑–∞–π–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω!';
            designAlert.style.display = 'block';
          }
          // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–∏–∑–∞–π–Ω —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
          applyDesign(design);
    } else {
          if (designAlert) {
            designAlert.className = 'alert alert-error';
            designAlert.textContent = result.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
            designAlert.style.display = 'block';
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞:', error);
        if (designAlert) {
          designAlert.className = 'alert alert-error';
          designAlert.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
          designAlert.style.display = 'block';
        }
      }
    });
  }

  // –°–±—Ä–æ—Å –∫ —É–º–æ–ª—á–∞–Ω–∏—é
  const resetDesignBtn = document.getElementById('reset-design-btn');
  if (resetDesignBtn) {
    resetDesignBtn.addEventListener('click', () => {
      if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–∑–∞–π–Ω–∞ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) return;
      
      designSettings = {
        primaryColor: '#f973b6',
        secondaryColor: '#a855f7',
        headerBg: '#f973b6',
        headerOpacity: 25,
        cardBg: '#ffffff',
        textColor: '#222222',
        buttonTextColor: '#ffffff',
        pageBg: '#f7f7fb',
        pageBgType: 'color',
        pageBgSecondary: '#ffffff',
        pageBgImage: '',
        logo: '',
        headerName: '',
        headerTitle: '',
        headerDescription: '',
        headerNameSize: 'normal',
        headerNameColor: '#ffffff',
        headerTitleSize: 'normal',
        headerTitleColor: '#ffffff',
        headerDescriptionSize: 'normal',
        headerDescriptionColor: '#ffffff',
        sectionServices: '',
        sectionMasters: '',
        sectionBooking: '',
        sectionLocation: '',
        labelMaster: '',
        optionAnyMaster: ''
      };
      
      applyDesignToForm();
      updatePreview();
    });
  }

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–∑–∞–π–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  loadDesignSettings();

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ header (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏)
  const headerOpacitySlider = document.getElementById('design-header-opacity');
  const headerOpacityValueSpan = document.getElementById('header-opacity-value');
  if (headerOpacitySlider && headerOpacityValueSpan) {
    headerOpacitySlider.addEventListener('input', (e) => {
      headerOpacityValueSpan.textContent = e.target.value;
    });
  }

  // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
  function applyDesign(design) {
    if (!design) return;

    const style = document.createElement('style');
    style.id = 'salon-custom-design';

    const primaryColor = design.primaryColor || '#f973b6';
    const secondaryColor = design.secondaryColor || '#a855f7';
    const headerBg = design.headerBg || '#f973b6';
    const headerOpacity = design.headerOpacity !== undefined ? design.headerOpacity : 25;
    const cardBg = design.cardBg || '#ffffff';
    const textColor = design.textColor || '#222222';
    const buttonTextColor = design.buttonTextColor || '#ffffff';
    const pageBg = design.pageBg || '#f7f7fb';
    const pageBgType = design.pageBgType || 'color';
    const pageBgSecondary = design.pageBgSecondary || '#ffffff';
    const pageBgImage = design.pageBgImage || '';

    // –í—ã—á–∏—Å–ª—è–µ–º, —Å–≤–µ—Ç–ª—ã–π –∏–ª–∏ —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–∫—Å—Ç–∞
    const isLightBg = isLightColor(cardBg);
    const finalTextColor = isLightBg ? textColor : '#ffffff';

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    let bodyBg = pageBg;
    if (pageBgType === 'gradient') {
      bodyBg = `linear-gradient(135deg, ${pageBg}, ${pageBgSecondary})`;
    } else if (pageBgType === 'image' && pageBgImage) {
      bodyBg = `url(${pageBgImage})`;
    }

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –ª–æ–≥–æ—Ç–∏–ø –≤ header, –µ—Å–ª–∏ –µ—Å—Ç—å
    if (design.logo) {
      const header = document.querySelector('header');
      const headerTitle = header ? header.querySelector('h1') : null;
      let logoImg = header ? header.querySelector('img.logo-img') : null;
      
      if (!logoImg && header && headerTitle) {
        logoImg = document.createElement('img');
        logoImg.src = design.logo;
        logoImg.className = 'logo-img';
        logoImg.alt = '–õ–æ–≥–æ—Ç–∏–ø —Å–∞–ª–æ–Ω–∞';
        logoImg.style.cssText = 'max-height: 80px; max-width: 200px; margin-bottom: 12px; display: block; margin-left: auto; margin-right: auto; object-fit: contain;';
        header.insertBefore(logoImg, headerTitle);
      } else if (logoImg) {
        logoImg.src = design.logo;
        logoImg.style.display = 'block';
      }
    } else {
      // –£–¥–∞–ª—è–µ–º –ª–æ–≥–æ—Ç–∏–ø, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
      const logoImg = document.querySelector('header img.logo-img');
      if (logoImg) logoImg.remove();
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–æ–Ω –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
    const isImageBg = pageBgType === 'image' && pageBgImage;
    const bgImageStyles = isImageBg ? `
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        background-attachment: fixed !important;
      ` : '';
    const bgImageStylesMobile = isImageBg ? `
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        background-attachment: scroll !important;
      ` : '';

    // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ style —ç–ª–µ–º–µ–Ω—Ç
    style.textContent = `
      html {
        background: ${bodyBg} !important;
        min-height: 100% !important;
        ${bgImageStyles}
      }
      body {
        background: transparent !important;
        min-height: 100% !important;
      }
      @media (max-width: 768px) {
        html {
          background: ${bodyBg} !important;
          ${bgImageStylesMobile}
        }
        body {
          background: transparent !important;
        }
      }
      @media (max-width: 480px) {
        html {
          background: ${bodyBg} !important;
          ${bgImageStylesMobile}
        }
        body {
          background: transparent !important;
        }
      }
      header {
        background: rgba(${hexToRgb(headerBg)}, ${(design.headerOpacity || 25) / 100}) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        border-bottom: 1px solid rgba(255, 255, 255, 0.18) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
        position: relative !important;
      }
      @media (max-width: 768px) {
        header {
          background: rgba(${hexToRgb(headerBg)}, ${(design.headerOpacity || 25) / 100}) !important;
          backdrop-filter: blur(20px) !important;
          -webkit-backdrop-filter: blur(20px) !important;
        }
      }
      @media (max-width: 480px) {
        header {
          background: rgba(${hexToRgb(headerBg)}, ${(design.headerOpacity || 25) / 100}) !important;
          backdrop-filter: blur(20px) !important;
          -webkit-backdrop-filter: blur(20px) !important;
        }
      }
      .card {
        background: ${cardBg} !important;
        color: ${finalTextColor} !important;
      }
      .card * {
        color: inherit !important;
      }
      .card h2,
      .card h3,
      .card h4,
      .card h5,
      .card h6 {
        color: ${finalTextColor} !important;
      }
      .card p,
      .card .description,
      .card .note,
      .card div,
      .card span:not(.price) {
        color: ${finalTextColor} !important;
      }
      .card label {
        color: ${finalTextColor} !important;
      }
      .btn-primary {
        background: linear-gradient(135deg, ${primaryColor}, ${secondaryColor}) !important;
        color: ${buttonTextColor} !important;
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, ${primaryColor}, ${secondaryColor}) !important;
        filter: brightness(1.1);
        color: ${buttonTextColor} !important;
      }
      .service-item span.price {
        color: ${primaryColor} !important;
      }
      .service-item span:first-child {
        color: ${finalTextColor} !important;
      }
      .master-item span {
        color: ${finalTextColor} !important;
      }
      .master-item span.role {
        color: ${finalTextColor} !important;
        opacity: 0.7;
      }
      input:focus, select:focus, textarea:focus {
        border-color: ${primaryColor} !important;
        box-shadow: 0 0 0 1px rgba(${hexToRgb(primaryColor)}, 0.35) !important;
      }
      input, select, textarea {
        color: ${finalTextColor} !important;
        background: ${isLightBg ? '#f9fafb' : 'rgba(255, 255, 255, 0.1)'} !important;
      }
      input::placeholder, textarea::placeholder {
        color: ${isLightBg ? '#9ca3af' : 'rgba(255, 255, 255, 0.6)'} !important;
      }
      .alert-success {
        background: #dcfce7 !important;
        color: #166534 !important;
      }
      .alert-error {
        background: #fee2e2 !important;
        color: #b91c1c !important;
      }
    `;

    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å—Ç–∏–ª—å, –µ—Å–ª–∏ –µ—Å—Ç—å
    const oldStyle = document.getElementById('salon-custom-design');
    if (oldStyle) oldStyle.remove();

    document.head.appendChild(style);
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Å–≤–µ—Ç–ª—ã–π –ª–∏ —Ü–≤–µ—Ç
  function isLightColor(hex) {
    const rgb = hexToRgbArray(hex);
    if (!rgb) return true;
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º—É–ª—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è—Ä–∫–æ—Å—Ç–∏
    const brightness = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;
    return brightness > 128;
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ hex –≤ –º–∞—Å—Å–∏–≤ RGB
  function hexToRgbArray(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? [
      parseInt(result[1], 16),
      parseInt(result[2], 16),
      parseInt(result[3], 16)
    ] : null;
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ hex –≤ rgb —Å—Ç—Ä–æ–∫—É
  function hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? 
      `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` 
      : '249, 115, 182';
  }

  // –í—ã—Ö–æ–¥
  const logoutLink = document.getElementById('logout-link');
  if (logoutLink) {
    logoutLink.addEventListener('click', async (e) => {
      e.preventDefault();
      await fetch('/api/logout', { 
        method: 'POST',
        credentials: 'include'
      });
      window.location.href = '/';
    });
  }

  // –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É
  const restoreBtn = document.getElementById('restore-account');
  if (restoreBtn) {
    restoreBtn.addEventListener('click', async () => {
      try {
        const response = await fetch('/api/users/restore', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });

        const result = await response.json();
        if (result.success) {
          alert('–í–æ–∑–≤—Ä–∞—Ç –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω');
          window.location.reload();
        } else {
          alert(result.message || '–û—à–∏–±–∫–∞');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É');
      }
    });
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–∞–ª–æ–Ω–µ
  let map = null;
  let placemark = null;

  function initMap() {
    if (typeof ymaps === 'undefined') {
      console.error('–Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ.');
      const mapEl = document.getElementById('map');
      if (mapEl) {
        mapEl.textContent = '';
        const msg = document.createElement('p');
        msg.style.cssText = 'padding: 20px; text-align: center; color: #6b7280;';
        msg.textContent = '–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º API –∫–ª—é—á –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç. –£–∫–∞–∂–∏—Ç–µ –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.';
        mapEl.appendChild(msg);
      }
      return;
    }

    // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—É—é –∫–∞—Ä—Ç—É, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if (map) {
      try {
        map.destroy();
        map = null;
        placemark = null;
      } catch (e) {
        console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ —Å—Ç–∞—Ä–æ–π –∫–∞—Ä—Ç—ã:', e);
      }
    }

    const mapEl = document.getElementById('map');
    if (!mapEl) return;

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã
    mapEl.textContent = '';

    ymaps.ready(() => {
      const lat = currentUser.salonLat || 41.3111; // –¢–∞—à–∫–µ–Ω—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      const lng = currentUser.salonLng || 69.2797;

      map = new ymaps.Map('map', {
        center: [lat, lng],
        zoom: 15,
        controls: ['zoomControl', 'fullscreenControl']
      });

      // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É, –µ—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –µ—Å—Ç—å
      if (currentUser.salonLat && currentUser.salonLng) {
        placemark = new ymaps.Placemark([currentUser.salonLat, currentUser.salonLng], {
          balloonContent: currentUser.salonAddress || currentUser.salonName || '–°–∞–ª–æ–Ω'
        }, {
          preset: 'islands#redDotIcon'
        });
        map.geoObjects.add(placemark);
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
      map.events.add('click', (e) => {
        const coords = e.get('coords');
        document.getElementById('salon-lat').value = coords[0];
        document.getElementById('salon-lng').value = coords[1];

        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –º–µ—Ç–∫—É
        if (placemark) {
          map.geoObjects.remove(placemark);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
        placemark = new ymaps.Placemark(coords, {
          balloonContent: currentUser.salonAddress || currentUser.salonName || '–°–∞–ª–æ–Ω'
        }, {
          preset: 'islands#redDotIcon'
        });
        map.geoObjects.add(placemark);
      });
    });
  }

  function loadSalonInfo() {
    const salonName = document.getElementById('salon-name');
    const salonAddress = document.getElementById('salon-address');
    const salonPhone = document.getElementById('salon-phone');
    const salonDisplayPhone = document.getElementById('salon-display-phone');
    const salonLat = document.getElementById('salon-lat');
    const salonLng = document.getElementById('salon-lng');
    const workHoursStart = document.getElementById('work-hours-start');
    const workHoursEnd = document.getElementById('work-hours-end');

    if (salonName) salonName.value = currentUser.salonName || '';
    if (salonAddress) salonAddress.value = currentUser.salonAddress || '';
    if (salonPhone) salonPhone.value = currentUser.salonPhone || '';
    if (salonDisplayPhone) salonDisplayPhone.value = currentUser.salonDisplayPhone || '';
    if (salonLat) salonLat.value = currentUser.salonLat || '';
    if (salonLng) salonLng.value = currentUser.salonLng || '';
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10-20)
    const workHours = currentUser.workHours || { startHour: 10, endHour: 20 };
    if (workHoursStart) workHoursStart.value = workHours.startHour || 10;
    if (workHoursEnd) workHoursEnd.value = workHours.endHour || 20;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
    const salonInfoTab = document.getElementById('salon-info-tab');
    if (salonInfoTab && salonInfoTab.classList.contains('active')) {
      setTimeout(initMap, 100);
    }
  }

  const salonForm = document.getElementById('salon-form');
  const salonAlert = document.getElementById('salon-alert');

  if (salonForm) {
    salonForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (salonAlert) salonAlert.style.display = 'none';

      const salonName = document.getElementById('salon-name').value.trim();
      const salonAddress = document.getElementById('salon-address').value.trim();
      const salonPhone = document.getElementById('salon-phone').value.trim();
      const salonDisplayPhone = document.getElementById('salon-display-phone').value.trim();
      const salonLat = document.getElementById('salon-lat').value;
      const salonLng = document.getElementById('salon-lng').value;
      const workHoursStart = parseInt(document.getElementById('work-hours-start').value);
      const workHoursEnd = parseInt(document.getElementById('work-hours-end').value);

      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
      if (!salonPhone || !salonPhone.trim()) {
        if (salonAlert) {
          salonAlert.className = 'alert alert-error';
          salonAlert.textContent = '–¢–µ–ª–µ—Ñ–æ–Ω –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
          salonAlert.style.display = 'block';
        }
        return;
      }

      const phoneDigits = salonPhone.replace(/\D/g, '');
      if (phoneDigits.length < 9) {
        if (salonAlert) {
          salonAlert.className = 'alert alert-error';
          salonAlert.textContent = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–º–∏–Ω–∏–º—É–º 9 —Ü–∏—Ñ—Ä)';
          salonAlert.style.display = 'block';
        }
        return;
      }

      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å–∞–ª–æ–Ω–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
      if (salonDisplayPhone && salonDisplayPhone.trim()) {
        const displayPhoneDigits = salonDisplayPhone.replace(/\D/g, '');
        if (displayPhoneDigits.length < 9) {
          if (salonAlert) {
            salonAlert.className = 'alert alert-error';
            salonAlert.textContent = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å–∞–ª–æ–Ω–∞ (–º–∏–Ω–∏–º—É–º 9 —Ü–∏—Ñ—Ä)';
            salonAlert.style.display = 'block';
          }
          return;
        }
      }

      // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
      if (isNaN(workHoursStart) || isNaN(workHoursEnd)) {
        if (salonAlert) {
          salonAlert.className = 'alert alert-error';
          salonAlert.textContent = '–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏';
          salonAlert.style.display = 'block';
        }
        return;
      }

      if (workHoursStart < 0 || workHoursStart > 23 || workHoursEnd < 0 || workHoursEnd > 23) {
        if (salonAlert) {
          salonAlert.className = 'alert alert-error';
          salonAlert.textContent = '–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 0 –¥–æ 23';
          salonAlert.style.display = 'block';
        }
        return;
      }

      if (workHoursStart >= workHoursEnd) {
        if (salonAlert) {
          salonAlert.className = 'alert alert-error';
          salonAlert.textContent = '–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è';
          salonAlert.style.display = 'block';
        }
        return;
      }

      try {
        const response = await fetch('/api/salon', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({
            salonName,
            salonAddress,
            salonPhone,
            salonDisplayPhone: salonDisplayPhone || null,
            salonLat: salonLat ? parseFloat(salonLat) : null,
            salonLng: salonLng ? parseFloat(salonLng) : null,
            workHours: {
              startHour: workHoursStart,
              endHour: workHoursEnd
            }
          })
        });

        const result = await response.json();
        if (result.success) {
          if (salonAlert) {
            salonAlert.className = 'alert alert-success';
            salonAlert.textContent = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!';
            salonAlert.style.display = 'block';
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          currentUser.salonName = salonName;
          currentUser.salonAddress = salonAddress;
          currentUser.salonPhone = salonPhone;
          currentUser.salonDisplayPhone = salonDisplayPhone || '';
          currentUser.salonLat = salonLat ? parseFloat(salonLat) : null;
          currentUser.salonLng = salonLng ? parseFloat(salonLng) : null;
          currentUser.workHours = { startHour: workHoursStart, endHour: workHoursEnd };

          // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ
          if (map && placemark && salonLat && salonLng) {
            map.geoObjects.remove(placemark);
            placemark = new ymaps.Placemark([parseFloat(salonLat), parseFloat(salonLng)], {
              balloonContent: salonAddress || salonName || '–°–∞–ª–æ–Ω'
            }, {
              preset: 'islands#redDotIcon'
            });
            map.geoObjects.add(placemark);
            map.setCenter([parseFloat(salonLat), parseFloat(salonLng)]);
          }
        } else {
          if (salonAlert) {
            salonAlert.className = 'alert alert-error';
            salonAlert.textContent = result.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
            salonAlert.style.display = 'block';
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        if (salonAlert) {
          salonAlert.className = 'alert alert-error';
          salonAlert.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∞–ª–æ–Ω–µ';
          salonAlert.style.display = 'block';
        }
      }
    });
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫ (–¶–≤–µ—Ç–∞, –ó–∞–≥–æ–ª–æ–≤–æ–∫, –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä)
  document.querySelectorAll('.tab-button[data-tab]').forEach(btn => {
    btn.addEventListener('click', () => {
      const tabName = btn.dataset.tab;
      
      // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
      document.querySelectorAll('.tab-button[data-tab]').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
        tab.classList.remove('active');
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      const targetTab = document.getElementById(`${tabName}-tab`);
      if (targetTab) {
        targetTab.style.display = 'block';
        targetTab.classList.add('active');
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä, –µ—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        if (tabName === 'preview') {
          updatePreview();
        }
      }
    });
  });

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≥–ª–∞–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
  document.querySelectorAll('.main-tab-button').forEach(button => {
    button.addEventListener('click', () => {
      const tabId = button.getAttribute('data-main-tab');
      
      // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      document.querySelectorAll('.main-tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.main-tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
      });
      
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      button.classList.add('active');
      const targetContent = document.getElementById(`${tabId}-tab`);
      if (targetContent) {
        targetContent.classList.add('active');
        targetContent.style.display = 'block';
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É, –µ—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∞–ª–æ–Ω–µ –∏ –∫–∞—Ä—Ç–∞ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
        if (tabId === 'salon-info' && typeof ymaps !== 'undefined' && !map) {
          setTimeout(initMap, 100);
        }
      }
    });
  });

  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  function highlightActivePage() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-links a, .header-top-links a');
    
    navLinks.forEach(link => {
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤—ã—Ö–æ–¥
      if (link.id === 'logout-link' || link.href === '#' || !link.href) {
        return;
      }
      
      try {
        const linkPath = new URL(link.href, window.location.origin).pathname;
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—É—Ç–∏ (—É–±–∏—Ä–∞–µ–º trailing slash)
        const normalizedCurrent = currentPath.replace(/\/$/, '') || '/';
        const normalizedLink = linkPath.replace(/\/$/, '') || '/';
        
        if (normalizedLink === normalizedCurrent) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      } catch (e) {
        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å URL, –ø—Ä–æ—Å—Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º href
        const href = link.getAttribute('href');
        if (href && (href === currentPath || href.replace(/\/$/, '') === currentPath.replace(/\/$/, ''))) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      }
    });
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û –±–æ—Ç–µ"
  const telegramBotInfoBtn = document.getElementById('telegram-bot-info-btn');
  const telegramBotInfoModal = document.getElementById('telegram-bot-info-modal');
  const telegramBotInfoModalClose = document.getElementById('telegram-bot-info-modal-close');
  const telegramBotLink = document.getElementById('telegram-bot-link');
  const telegramBotLinkLoading = document.getElementById('telegram-bot-link-loading');
  const telegramBotLinkError = document.getElementById('telegram-bot-link-error');

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  if (telegramBotInfoBtn && telegramBotInfoModal) {
    telegramBotInfoBtn.addEventListener('click', async () => {
      telegramBotInfoModal.style.display = 'flex';
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
      try {
        telegramBotLinkLoading.style.display = 'block';
        telegramBotLink.style.display = 'none';
        telegramBotLinkError.style.display = 'none';

        const response = await fetch('/api/telegram/connect-link', {
          credentials: 'include'
        });

        if (response.ok) {
          const data = await response.json();
          
          if (data.success && data.botUsername) {
            const botUrl = `https://t.me/${data.botUsername}`;
            telegramBotLink.href = botUrl;
            telegramBotLink.style.display = 'inline-block';
            telegramBotLinkLoading.style.display = 'none';
          } else {
            telegramBotLinkLoading.style.display = 'none';
            telegramBotLinkError.style.display = 'block';
          }
        } else {
          telegramBotLinkLoading.style.display = 'none';
          telegramBotLinkError.style.display = 'block';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ:', error);
        telegramBotLinkLoading.style.display = 'none';
        telegramBotLinkError.style.display = 'block';
      }
    });
  }

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
  if (telegramBotInfoModalClose && telegramBotInfoModal) {
    telegramBotInfoModalClose.addEventListener('click', () => {
      telegramBotInfoModal.style.display = 'none';
    });
  }

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
  if (telegramBotInfoModal) {
    telegramBotInfoModal.addEventListener('click', (e) => {
      if (e.target === telegramBotInfoModal) {
        telegramBotInfoModal.style.display = 'none';
      }
    });
  }

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  loadUserData();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  loadTelegramSettings();
  
  // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  highlightActivePage();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram
  async function loadTelegramSettings() {
    try {
      const response = await fetch('/api/telegram/settings', {
        credentials: 'include'
      });
      if (response.ok) {
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          console.error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram:', text.substring(0, 200));
          return;
        }
        const data = await response.json();
        if (data.success) {
          const settings = data.settings || {};
          const isConnected = data.telegramId !== null && data.telegramId !== undefined;
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –ø–æ–ª–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
          const botTokenInput = document.getElementById('telegram-bot-token');
          if (botTokenInput && data.botToken) {
            botTokenInput.value = data.botToken;
            console.log('–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –ø–æ–ª–µ (–¥–ª–∏–Ω–∞:', data.botToken.length, '—Å–∏–º–≤–æ–ª–æ–≤)');
          } else if (botTokenInput && data.botTokenInDb) {
            // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å –≤ –ë–î, –Ω–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (–∏–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏), –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏
            botTokenInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            botTokenInput.placeholder = '–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω (–≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è)';
          } else if (botTokenInput) {
            botTokenInput.value = '';
            botTokenInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz)';
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ç–æ–∫–µ–Ω–∞
          const botTokenStatus = document.getElementById('bot-token-status');
          if (botTokenStatus) {
            if (data.botTokenConfigured) {
              botTokenStatus.textContent = `‚úÖ –¢–æ–∫–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω (${data.botTokenLength || 0} —Å–∏–º–≤–æ–ª–æ–≤)`;
              botTokenStatus.style.color = '#10b981';
            } else {
              botTokenStatus.textContent = '‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –£–∫–∞–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_BOT_TOKEN.';
              botTokenStatus.style.color = '#f59e0b';
            }
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
          const statusText = document.getElementById('telegram-status-text');
          const statusBadge = document.getElementById('telegram-status-badge');
          const connectBtn = document.getElementById('telegram-connect-btn');
          const reconnectBtn = document.getElementById('telegram-reconnect-btn');
          const disconnectBtn = document.getElementById('telegram-disconnect-btn');
          
          if (isConnected) {
            statusText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
            statusBadge.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
            statusBadge.style.background = '#10b981';
            statusBadge.style.color = '#fff';
            connectBtn.style.display = 'none';
            reconnectBtn.style.display = 'inline-block';
            disconnectBtn.style.display = 'inline-block';
          } else {
            statusText.textContent = '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            statusBadge.textContent = '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            statusBadge.style.background = '#ef4444';
            statusBadge.style.color = '#fff';
            connectBtn.style.display = 'inline-block';
            reconnectBtn.style.display = 'none';
            disconnectBtn.style.display = 'none';
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–±–æ–∫—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
          document.getElementById('telegram-enabled').checked = settings.enabled !== false;
          document.getElementById('telegram-notify-new-bookings').checked = settings.notifyNewBookings !== false;
          document.getElementById('telegram-notify-cancellations').checked = settings.notifyCancellations === true;
          document.getElementById('telegram-notify-changes').checked = settings.notifyChanges === true;
        }
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram:', error);
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram
  const telegramForm = document.getElementById('telegram-form');
  if (telegramForm) {
    telegramForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const alertDiv = document.getElementById('telegram-alert');
      alertDiv.style.display = 'none';
      
      const botTokenInput = document.getElementById('telegram-bot-token');
      const botToken = botTokenInput ? botTokenInput.value.trim() : '';
      
      const settings = {
        enabled: document.getElementById('telegram-enabled').checked,
        notifyNewBookings: document.getElementById('telegram-notify-new-bookings').checked,
        notifyCancellations: document.getElementById('telegram-notify-cancellations').checked,
        notifyChanges: document.getElementById('telegram-notify-changes').checked
      };
      
      // –í—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º botToken (–¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —É–¥–∞–ª–∏—Ç—å)
      if (botTokenInput) {
        settings.botToken = botToken;
      }
      
      try {
        const response = await fetch('/api/telegram/settings', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(settings),
          credentials: 'include'
        });
        
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          throw new Error(`–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON. –°—Ç–∞—Ç—É—Å: ${response.status}, –û—Ç–≤–µ—Ç: ${text.substring(0, 200)}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          alertDiv.className = 'alert success';
          alertDiv.textContent = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
          alertDiv.style.display = 'block';
          
          // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI (–≤–∫–ª—é—á–∞—è —Ç–æ–∫–µ–Ω)
          await loadTelegramSettings();
        } else {
          alertDiv.className = 'alert error';
          alertDiv.textContent = data.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫';
          alertDiv.style.display = 'block';
        }
      } catch (error) {
        alertDiv.className = 'alert error';
        alertDiv.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫';
        alertDiv.style.display = 'block';
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram:', error);
      }
    });
  }

  // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram
  const telegramConnectBtn = document.getElementById('telegram-connect-btn');
  if (telegramConnectBtn) {
    telegramConnectBtn.addEventListener('click', async () => {
      const alertDiv = document.getElementById('telegram-alert');
      alertDiv.style.display = 'none';
      
      try {
        const response = await fetch('/api/telegram/connect-link', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success && data.botUsername) {
          // –û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram –±–æ—Ç–∞
          window.open(`https://t.me/${data.botUsername}?start=start_connect`, '_blank');
          alertDiv.className = 'alert info';
          alertDiv.textContent = '–û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç" –≤ –±–æ—Ç–µ';
          alertDiv.style.display = 'block';
        } else {
          alertDiv.className = 'alert error';
          alertDiv.textContent = data.message || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –±–æ—Ç–∞';
          alertDiv.style.display = 'block';
          
          // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
          if (response.status === 503 && data.message && data.message.includes('–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω')) {
            alertDiv.innerHTML = data.message + '<br><br><strong>–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:</strong><br>1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram (–≤–∫–ª–∞–¥–∫–∞ –≤—ã—à–µ)<br>2. –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –ø–æ–ª–µ "–¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞"<br>3. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"<br>4. –¢–æ–∫–µ–Ω –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É @BotFather –≤ Telegram';
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram:', error);
        alertDiv.className = 'alert error';
        alertDiv.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.';
        alertDiv.style.display = 'block';
      }
    });
  }

  // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram
  const telegramReconnectBtn = document.getElementById('telegram-reconnect-btn');
  if (telegramReconnectBtn) {
    telegramReconnectBtn.addEventListener('click', async () => {
      try {
        const response = await fetch('/api/telegram/connect-link', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success && data.botUsername) {
          window.open(`https://t.me/${data.botUsername}?start=start_connect`, '_blank');
          const alertDiv = document.getElementById('telegram-alert');
          alertDiv.className = 'alert info';
          alertDiv.textContent = '–û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç" –≤ –±–æ—Ç–µ';
          alertDiv.style.display = 'block';
        } else {
          const alertDiv = document.getElementById('telegram-alert');
          alertDiv.className = 'alert error';
          alertDiv.textContent = data.message || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –±–æ—Ç–∞';
          alertDiv.style.display = 'block';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram:', error);
        const alertDiv = document.getElementById('telegram-alert');
        alertDiv.className = 'alert error';
        alertDiv.textContent = '–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram';
        alertDiv.style.display = 'block';
      }
    });
  }

  // –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è Telegram
  const telegramDisconnectBtn = document.getElementById('telegram-disconnect-btn');
  if (telegramDisconnectBtn) {
    telegramDisconnectBtn.addEventListener('click', async () => {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å Telegram? –í—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.')) {
        return;
      }
      
      try {
        const response = await fetch('/api/telegram/unlink', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        
        const data = await response.json();
        
        if (data.success) {
          const alertDiv = document.getElementById('telegram-alert');
          alertDiv.className = 'alert success';
          alertDiv.textContent = 'Telegram —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω';
          alertDiv.style.display = 'block';
          loadTelegramSettings(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        } else {
          const alertDiv = document.getElementById('telegram-alert');
          alertDiv.className = 'alert error';
          alertDiv.textContent = data.message || '–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è Telegram';
          alertDiv.style.display = 'block';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è Telegram:', error);
        const alertDiv = document.getElementById('telegram-alert');
        alertDiv.className = 'alert error';
        alertDiv.textContent = '–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è Telegram';
        alertDiv.style.display = 'block';
      }
    });
  }


  // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
  loadUserData().then(() => {
    const currentUser = window.currentUser;
    if (currentUser && (currentUser.role === 'admin' || currentUser.username === 'admin')) {
      loadTelegramSettings();
    }
  });
</script>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div class="notification-container" id="notification-container"></div>

<!-- –ò–∫–æ–Ω–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div class="notifications-icon" id="notifications-icon">
  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25-2.5 7-2.5 7h15s-2.5-1.75-2.5-7c0-3.87-3.13-7-7-7zm0 2c2.76 0 5 2.24 5 5 0 2.88 2.88 4.5 2.88 4.5H4.12S7 11.88 7 9c0-2.76 2.24-5 5-5zm-1 15h2v2h-2v-2z"/>
  </svg>
  <div class="notifications-badge hidden" id="notifications-badge">0</div>
</div>

<!-- –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div class="notifications-panel" id="notifications-panel">
  <div class="notifications-panel-header">
    <div class="notifications-panel-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
    <button class="notifications-panel-close" id="notifications-panel-close">√ó</button>
  </div>
  <div class="notifications-panel-body" id="notifications-panel-body">
    <div class="notifications-panel-empty">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
  </div>
  <div class="notifications-panel-footer">
    <button class="notifications-clear-all" id="notifications-clear-all">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
  </div>
</div>

<script>
  // –•—Ä–∞–Ω–∏–ª–∏—â–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  let notificationsList = JSON.parse(localStorage.getItem('notifications') || '[]');
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ localStorage
  function saveNotifications() {
    localStorage.setItem('notifications', JSON.stringify(notificationsList));
    updateNotificationsPanel();
    updateNotificationsBadge();
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫
  function addNotificationToList(title, message, type = 'success', bookingId = null) {
    const notification = {
      id: Date.now(),
      title,
      message,
      type,
      time: new Date().toISOString(),
      read: false,
      bookingId: bookingId // ID –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞
    };
    
    notificationsList.unshift(notification); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50)
    if (notificationsList.length > 50) {
      notificationsList = notificationsList.slice(0, 50);
    }
    
    saveNotifications();
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function updateNotificationsBadge() {
    const badge = document.getElementById('notifications-badge');
    if (!badge) return;
    
    const unreadCount = notificationsList.filter(n => !n.read).length;
    if (unreadCount > 0) {
      badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
      badge.classList.remove('hidden');
    } else {
      badge.classList.add('hidden');
    }
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function updateNotificationsPanel() {
    const panelBody = document.getElementById('notifications-panel-body');
    if (!panelBody) return;
    
    if (notificationsList.length === 0) {
      panelBody.textContent = '';
      const emptyEl = document.createElement('div');
      emptyEl.className = 'notifications-panel-empty';
      emptyEl.textContent = '–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π';
      panelBody.appendChild(emptyEl);
      return;
    }
    
    const icons = {
      success: '‚úì',
      error: '‚úï',
      warning: '‚ö†',
      info: '‚Ñπ'
    };
    
    const iconColors = {
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      info: '#3b82f6'
    };
    
    panelBody.textContent = '';
    notificationsList.forEach(notif => {
      const date = new Date(notif.time);
      const timeStr = date.toLocaleString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      const item = document.createElement('div');
      item.className = `notification-item ${notif.read ? '' : 'unread'}`;
      item.dataset.id = notif.id;
      item.dataset.bookingId = notif.bookingId || '';
      
      const iconEl = document.createElement('div');
      iconEl.className = 'notification-item-icon';
      iconEl.style.color = iconColors[notif.type] || iconColors.success;
      iconEl.textContent = icons[notif.type] || icons.success;
      
      const contentEl = document.createElement('div');
      contentEl.className = 'notification-item-content';
      
      const titleEl = document.createElement('div');
      titleEl.className = 'notification-item-title';
      titleEl.textContent = notif.title;
      
      const messageEl = document.createElement('div');
      messageEl.className = 'notification-item-message';
      messageEl.textContent = notif.message;
      
      const timeEl = document.createElement('div');
      timeEl.className = 'notification-item-time';
      timeEl.textContent = timeStr;
      
      contentEl.appendChild(titleEl);
      contentEl.appendChild(messageEl);
      contentEl.appendChild(timeEl);
      
      const closeBtn = document.createElement('button');
      closeBtn.className = 'notification-item-close';
      closeBtn.textContent = '√ó';
      closeBtn.onclick = () => removeNotification(notif.id);
      
      item.appendChild(iconEl);
      item.appendChild(contentEl);
      item.appendChild(closeBtn);
      panelBody.appendChild(item);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞
    panelBody.querySelectorAll('.notification-item').forEach(item => {
      item.addEventListener('click', (e) => {
        if (e.target.classList.contains('notification-item-close')) return;
        const notifId = parseInt(item.dataset.id);
        const notification = notificationsList.find(n => n.id === notifId);
        markAsRead(notifId);
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å bookingId, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        if (notification && notification.bookingId) {
          window.location.href = `/calendar?bookingId=${notification.bookingId}`;
        }
      });
    });
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ
  function markAsRead(id) {
    const notification = notificationsList.find(n => n.id === id);
    if (notification && !notification.read) {
      notification.read = true;
      saveNotifications();
    }
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  function removeNotification(id) {
    notificationsList = notificationsList.filter(n => n.id !== id);
    saveNotifications();
  }
  
  // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ onclick
  window.removeNotification = removeNotification;
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function showNotification(title, message, type = 'success', bookingId = null) {
    console.log('showNotification –≤—ã–∑–≤–∞–Ω–∞:', { title, message, type, bookingId });
    
    try {
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫
      if (typeof addNotificationToList === 'function') {
    addNotificationToList(title, message, type, bookingId);
      } else {
        console.error('–§—É–Ω–∫—Ü–∏—è addNotificationToList –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
      }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const container = document.getElementById('notification-container');
      if (!container) {
        console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        return;
      }
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    const icons = {
      success: '‚úì',
      error: '‚úï',
      warning: '‚ö†',
      info: '‚Ñπ'
    };
    
    const escapeHtml = (str) => {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    };
    
    const iconEl = document.createElement('div');
    iconEl.className = 'notification-icon';
    iconEl.textContent = icons[type] || icons.success;
    
    const contentEl = document.createElement('div');
    contentEl.className = 'notification-content';
    
    const titleEl = document.createElement('div');
    titleEl.className = 'notification-title';
    titleEl.textContent = title;
    
    const messageEl = document.createElement('div');
    messageEl.className = 'notification-message';
    messageEl.textContent = message;
    
    contentEl.appendChild(titleEl);
    contentEl.appendChild(messageEl);
    
    const closeBtn = document.createElement('button');
    closeBtn.className = 'notification-close';
    closeBtn.textContent = '√ó';
    closeBtn.onclick = () => notification.remove();
    
    notification.appendChild(iconEl);
    notification.appendChild(contentEl);
    notification.appendChild(closeBtn);
    
    container.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
      notification.classList.add('hiding');
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 300);
    }, 5000);
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –≤ showNotification:', error);
    }
  }
  
  // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  window.showNotification = showNotification;
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  document.getElementById('notifications-icon')?.addEventListener('click', () => {
    const panel = document.getElementById('notifications-panel');
    if (panel) {
      panel.classList.toggle('open');
      if (panel.classList.contains('open')) {
        // –û—Ç–º–µ—á–∞–µ–º –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        notificationsList.forEach(n => n.read = true);
        saveNotifications();
      }
    }
  });
  
  document.getElementById('notifications-panel-close')?.addEventListener('click', () => {
    const panel = document.getElementById('notifications-panel');
    if (panel) {
      panel.classList.remove('open');
    }
  });
  
  document.getElementById('notifications-clear-all')?.addEventListener('click', () => {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?')) {
      notificationsList = [];
      saveNotifications();
    }
  });
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ—ë
  document.addEventListener('click', (e) => {
    const panel = document.getElementById('notifications-panel');
    const icon = document.getElementById('notifications-icon');
    if (panel && icon && !panel.contains(e.target) && !icon.contains(e.target)) {
      panel.classList.remove('open');
    }
  });
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  // –ñ–¥–µ–º, –ø–æ–∫–∞ DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      updateNotificationsPanel();
      updateNotificationsBadge();
    });
  } else {
    updateNotificationsPanel();
    updateNotificationsBadge();
  }
  
  // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏: testNotification())
  window.testNotification = function() {
    showNotification('–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ', '–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç!', 'success');
  };
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
  let knownBookingIds = new Set(); // –ú–Ω–æ–∂–µ—Å—Ç–≤–æ ID –∑–∞–ø–∏—Å–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —É–∂–µ –≤–∏–¥–µ–ª–∏
  let lastBookingCheck = 0; // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∫ 0, —á—Ç–æ–±—ã –ø–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  
  async function checkNewBookings() {
    try {
      console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π...');
      const bookingsRes = await fetch('/api/bookings', {
        credentials: 'include'
      });
      if (!bookingsRes.ok) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π:', bookingsRes.status);
        return;
      }
      
      const contentType = bookingsRes.headers.get('content-type');
      if (!contentType || !contentType.includes('application/json')) {
        const text = await bookingsRes.text();
        console.error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–ø–∏—Å–µ–π:', text.substring(0, 200));
        return;
      }
      
      const bookingsResult = await bookingsRes.json();
      
      if (bookingsResult.success && bookingsResult.bookings) {
        const currentBookings = bookingsResult.bookings;
        
        // –ù–∞—Ö–æ–¥–∏–º –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ (—Ç–µ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ knownBookingIds)
        const newBookings = currentBookings.filter(booking => {
          const bookingId = String(booking.id);
          if (!knownBookingIds.has(bookingId)) {
            knownBookingIds.add(bookingId);
            return true;
          }
          return false;
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
        // –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 2 —Å–µ–∫—É–Ω–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (—á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ)
        const timeSinceLastCheck = lastBookingCheck > 0 ? Date.now() - lastBookingCheck : 0;
        if (newBookings.length > 0 && timeSinceLastCheck > 2000) {
          console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${newBookings.length} –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π (–ø—Ä–æ—à–ª–æ ${timeSinceLastCheck}–º—Å)`);
          newBookings.forEach(booking => {
            const date = new Date(booking.date);
            const dateStr = date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
            console.log('üì¢ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø–∏—Å–∏:', booking.id, booking.name);
            // –î–æ–±–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫
            if (typeof addNotificationToList === 'function') {
              addNotificationToList(
                '–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å!',
                `${booking.name} - ${booking.service} –Ω–∞ ${dateStr} –≤ ${booking.time}`,
                'info',
                booking.id
              );
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (typeof showNotification === 'function') {
              showNotification(
                '–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å!',
                `${booking.name} - ${booking.service} –Ω–∞ ${dateStr} –≤ ${booking.time}`,
                'info',
                booking.id
              );
            } else {
              console.error('‚ùå –§—É–Ω–∫—Ü–∏—è showNotification –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
          });
        } else if (newBookings.length > 0) {
          console.log(`‚ÑπÔ∏è –ù–∞–π–¥–µ–Ω–æ ${newBookings.length} –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π, –Ω–æ –ø—Ä–æ—à–ª–æ —Ç–æ–ª—å–∫–æ ${timeSinceLastCheck}–º—Å —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω—É–∂–Ω–æ > 2000–º—Å)`);
        } else {
          console.log(`‚ÑπÔ∏è –ù–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–≤—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${currentBookings.length}, –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö: ${knownBookingIds.size})`);
        }
        
        lastBookingCheck = Date.now();
      } else {
        console.log('–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –∏–ª–∏ –æ—à–∏–±–∫–∞:', bookingsResult);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π:', error);
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
  let notificationCheckInterval = null;
  
  async function initNotificationCheck() {
    try {
      console.log('üîî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π...');
      const bookingsRes = await fetch('/api/bookings', {
        credentials: 'include'
      });
      if (!bookingsRes.ok) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', bookingsRes.status);
        // –í—Å–µ —Ä–∞–≤–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if (!notificationCheckInterval) {
          notificationCheckInterval = setInterval(checkNewBookings, 30000);
          console.log('‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞–ø—É—â–µ–Ω–∞ (–ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π)');
        }
        return;
      }
      
      const contentType = bookingsRes.headers.get('content-type');
      if (!contentType || !contentType.includes('application/json')) {
        const text = await bookingsRes.text();
        console.error('‚ùå –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', text.substring(0, 200));
        // –í—Å–µ —Ä–∞–≤–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        if (!notificationCheckInterval) {
          notificationCheckInterval = setInterval(checkNewBookings, 30000);
          console.log('‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞–ø—É—â–µ–Ω–∞ (–ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞)');
        }
        return;
      }
      
      const bookingsResult = await bookingsRes.json();
      if (bookingsResult.success && bookingsResult.bookings) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –≤—Å–µ—Ö —Ç–µ–∫—É—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –∫–∞–∫ —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ
        bookingsResult.bookings.forEach(booking => {
          knownBookingIds.add(String(booking.id));
        });
        
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (notificationCheckInterval) {
          clearInterval(notificationCheckInterval);
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º lastBookingCheck, —á—Ç–æ–±—ã –ø–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        lastBookingCheck = Date.now();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ (—É–º–µ–Ω—å—à–∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏)
        notificationCheckInterval = setInterval(checkNewBookings, 15000);
        console.log(`‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (${knownBookingIds.size} –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π, –∏–Ω—Ç–µ—Ä–≤–∞–ª: 15 —Å–µ–∫—É–Ω–¥)`);
        
        // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        setTimeout(() => {
          console.log('üîç –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π...');
          checkNewBookings();
        }, 3000);
      } else {
        console.log('–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –æ—à–∏–±–∫–∞:', bookingsResult);
        // –í—Å–µ —Ä–∞–≤–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç
        if (!notificationCheckInterval) {
          notificationCheckInterval = setInterval(checkNewBookings, 30000);
          console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞–ø—É—â–µ–Ω–∞ (–∑–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç)');
        }
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–∏—Å–µ–π:', error);
      // –í—Å–µ —Ä–∞–≤–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
      if (!notificationCheckInterval) {
        notificationCheckInterval = setInterval(checkNewBookings, 30000);
        console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞–ø—É—â–µ–Ω–∞ (–ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)');
      }
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  setTimeout(initNotificationCheck, 2000);
</script>
</body>
</html>

